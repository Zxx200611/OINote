给出一个长度为 $n$​ 的未知序列 $S$​，已知的 $S$​ 在一些下标的值 $S_{p_i} = v_i$​，还有 $m$ 个形如 “在下标 $[l,r]$ 的范围内，下表为 $x_1 \dots x_k$ 的 $k$ 个数是最大的 $k$​ 个值” 的限制条件。

问是否存在一个序列 $S$​​ 满足以上条件。

$n \le 10^6$​，$m \le 2 \times 10^6$，$\sum k \le 3 \times 10^6$。

---

如果限制条件形如 $S_x > S_y$，就是差分约束模板题。即对于每一组限制条件 $S_x > S_y$ 在图中连一条边 $y \to x$。

建图后在图中跑拓扑排序：若不存在拓扑序，或有一个点算出的最小答案比已知值大，则无解。若存在拓扑序且没有算出答案比已知值大的点，则有解。



那么考虑此题，是一个类似区间修改的限制条件，且 $\sum k$ 较小。可以考虑线段树优化建图。

将限制条件的 $[l,r]$ 用 $x$​ 断开成形如 $[l,x_1-1]$，$[x_1+1,x_2-1]$，......$[x_k+1,r]$ 的一堆小区间，每一段单独向每个 $x$ 连边，边权为 $1$。由于 $k$ 小，时间复杂度并不会受到很大影响。

但这样边数太多了。有一个 Trick：每次询问建一个虚点，每个区间向此点连边，此点向每个 $x$ 连边。



至此，时间复杂度为 $O(mk\log n+n\log n) = O(mk \log n)$，足以通过此题。